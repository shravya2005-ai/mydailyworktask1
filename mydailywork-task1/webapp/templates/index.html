<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Rule based Chatbot — Interactive</title>
    <!-- Unique font for heading -->
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@600;700&display=swap" rel="stylesheet">
    <style>
  :root{ --bg-1:#f6f8ff; --bg-2:#fff9f3; --panel:#ffffff; --glass:rgba(255,255,255,0.7); --user:#b8f2e6; --user-2:#a7f3d0; --bot:#d8cfe7; --bot-2:#f3d6ff; --muted:#7b8794 }
      *{box-sizing:border-box}
      html,body{height:100%}
  body { font-family: Inter, system-ui, Arial, sans-serif; background: radial-gradient(800px 400px at 10% 10%, var(--bg-1) 0%, var(--bg-2) 50%), linear-gradient(180deg,var(--bg-1),var(--bg-2)); color:#102027; margin:0; padding:2.5rem; display:flex; align-items:center; justify-content:center }
      .container{ width:100%; max-width:820px; padding:1rem }
  .card{ background:var(--panel); border-radius:14px; box-shadow:0 10px 30px rgba(16,24,40,0.06); padding:18px; border:1px solid rgba(16,24,40,0.04) }
      header{ display:flex; align-items:center; gap:12px }
  h1{ margin:.15rem 0; font-size:1.5rem; color:#102027; font-family: 'Quicksand', Inter, system-ui, Arial, sans-serif; letter-spacing:0.6px }
      .subtitle{ color:var(--muted); font-size:0.9rem }
  .chat-window{ height:460px; overflow:auto; border-radius:10px; padding:14px; margin-top:14px; background:linear-gradient(180deg, rgba(255,255,255,0.9), rgba(255,255,255,0.98)); border:1px solid rgba(16,24,40,0.02) }
      .msg{ display:flex; gap:10px; margin-bottom:12px; align-items:flex-end; opacity:0; transform:translateY(6px); animation:fadeUp .28s ease forwards }
      .bubble{ padding:.6rem .95rem; border-radius:14px; max-width:78%; box-shadow:0 6px 18px rgba(2,6,23,0.6); line-height:1.25 }
      .user{ justify-content:flex-end }
  .user .bubble{ background:linear-gradient(90deg,var(--user),var(--user-2)); color:#043029; margin-left:auto; border-bottom-right-radius:6px }
      .bot{ justify-content:flex-start }
  .bot .bubble{ background:linear-gradient(90deg,var(--bot),var(--bot-2)); color:#2b143b; margin-right:auto; border-bottom-left-radius:6px; border:1px solid rgba(43,20,59,0.04) }
      .controls{ display:flex; gap:.6rem; margin-top:14px }
  input[type=text]{ flex:1; padding:.6rem .9rem; border-radius:10px; border:1px solid rgba(16,24,40,0.06); background:transparent; color:#102027 }
  input[type=text]::placeholder{ color:rgba(16,32,39,0.35) }
  button{ padding:.6rem .95rem; border-radius:10px; background:linear-gradient(90deg,#ffd5ec,#dbeafe); color:#102027; border:none; cursor:pointer }
      .note{ font-size:.85rem; color:var(--muted); margin-top:.5rem }
      footer{ margin-top:.75rem; font-size:.82rem; color:var(--muted) }

      /* typing indicator */
      .typing{ display:inline-flex; gap:6px; align-items:center; padding:.45rem .6rem; border-radius:10px; background:rgba(255,255,255,0.02) }
      .dot{ width:7px; height:7px; background:rgba(255,255,255,0.22); border-radius:50%; opacity:0.9; transform:translateY(0); animation:blink 1s infinite }
      .dot.d2{ animation-delay:0.12s }
      .dot.d3{ animation-delay:0.24s }

      @keyframes blink{ 0%{transform:translateY(0); opacity:.25} 50%{transform:translateY(-5px); opacity:1} 100%{transform:translateY(0); opacity:.25} }
      @keyframes fadeUp{ to{ opacity:1; transform:none } }

      /* subtle focus */
      input[type=text]:focus{ outline:none; box-shadow:0 6px 30px rgba(6,11,22,0.6) inset }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="card">
        <header>
          <svg width="36" height="36" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="24" height="24" rx="6" fill="#0366d6"/><path d="M8 12h8M8 8h8M8 16h5" stroke="#fff" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
          <div>
            <h1>Rule based Chatbot</h1>
            <div class="subtitle">Simple rule-based responses — try greetings, math, or ask the time.</div>
          </div>
        </header>

  <div id="chat" class="chat-window" aria-live="polite">
          <!-- Server-rendered message (for non-JS or tests) -->
          {% if user_input %}
            <div class="msg user"><div class="bubble">{{ user_input }}</div></div>
          {% endif %}

          {% if response %}
            <div class="msg bot"><div class="bubble">{{ response }}</div></div>
          {% endif %}
        </div>

        

        <form id="chat-form" method="post" action="/" class="controls" onsubmit="return false;">
          <input id="message" name="message" type="text" autocomplete="off" placeholder="Say something — e.g. 'Hello' or 'add 3 and 4'" value="{{ user_input }}" />
          <button id="send">Send</button>
        </form>

  <footer>Press Enter to send.</footer>
      </div>
    </div>

    <script>
      (function(){
        const form = document.getElementById('chat-form');
        const input = document.getElementById('message');
        const chat = document.getElementById('chat');

        function appendMessage(kind, text, opts={}){
          const wrap = document.createElement('div');
          wrap.className = 'msg ' + kind;
          const bubble = document.createElement('div');
          bubble.className = 'bubble';
          bubble.textContent = text;
          wrap.appendChild(bubble);
          if(opts.before) chat.insertBefore(wrap, opts.before);
          else chat.appendChild(wrap);
          chat.scrollTop = chat.scrollHeight;
          return wrap;
        }

        function makeTyping(){
          const wrap = document.createElement('div');
          wrap.className = 'msg bot';
          const typing = document.createElement('div');
          typing.className = 'typing';
          const d1 = document.createElement('span'); d1.className='dot d1';
          const d2 = document.createElement('span'); d2.className='dot d2';
          const d3 = document.createElement('span'); d3.className='dot d3';
          typing.appendChild(d1); typing.appendChild(d2); typing.appendChild(d3);
          wrap.appendChild(typing);
          chat.appendChild(wrap);
          chat.scrollTop = chat.scrollHeight;
          return wrap;
        }

        async function send(text){
          if(!text) return;
          appendMessage('user', text);
          input.value = '';

          // show typing indicator
          const typingNode = makeTyping();

          try{
            const start = Date.now();
            const res = await fetch('/api/respond', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ text })
            });
            const json = await res.json();

            // ensure typing shows for at least 300ms for smoother UX
            const elapsed = Date.now() - start;
            const wait = Math.max(0, 300 - elapsed);
            setTimeout(()=>{
              typingNode.remove();
              appendMessage('bot', json.response || 'No response');
            }, wait);
          }catch(e){
            typingNode.remove();
            appendMessage('bot', 'Error: could not reach server');
          }
        }

        // Enter to send
        input.addEventListener('keydown', (e)=>{
          if(e.key === 'Enter'){
            e.preventDefault();
            const t = input.value.trim();
            if(t) send(t);
          }
        });

        document.getElementById('send').addEventListener('click', (e)=>{
          e.preventDefault();
          const t = input.value.trim();
          if(t) send(t);
        });
      })();
    </script>
  </body>
</html>
